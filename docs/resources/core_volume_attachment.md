---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "hyperstack_core_volume_attachment Resource - terraform-provider-hyperstack"
subcategory: ""
description: |-
  Manages volume attachments to virtual machines in Hyperstack.
---

# hyperstack_core_volume_attachment (Resource)

Manages volume attachments to virtual machines in Hyperstack. This resource allows you to attach one or more volumes to a virtual machine.

## Example Usage

```terraform
# Create a virtual machine
resource "hyperstack_core_virtual_machine" "example" {
  name             = "my-vm"
  environment_name = "my-environment"
  key_name         = "my-keypair"
  image_name       = "Ubuntu 22.04 LTS"
  flavor_name      = "n1-cpu-small"
}

# Create data volumes (non-bootable)
resource "hyperstack_core_volume" "data1" {
  name             = "data-volume-1"
  environment_name = "my-environment"
  size             = 100
  volume_type      = "ssd"
  description      = "Additional storage for my-vm"
  image_id         = null  # Non-bootable volume
}

resource "hyperstack_core_volume" "data2" {
  name             = "data-volume-2"
  environment_name = "my-environment"
  size             = 200
  volume_type      = "ssd"
  description      = "Additional storage for my-vm"
  image_id         = null  # Non-bootable volume
}

# Attach volumes to the VM
resource "hyperstack_core_volume_attachment" "example" {
  vm_id      = hyperstack_core_virtual_machine.example.id
  volume_ids = [
    hyperstack_core_volume.data1.id,
    hyperstack_core_volume.data2.id,
  ]
  protected = false

  depends_on = [
    hyperstack_core_volume.data1,
    hyperstack_core_volume.data2,
    hyperstack_core_virtual_machine.example
  ]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `vm_id` (Number) The ID of the virtual machine to attach volumes to.
- `volume_ids` (List of Number) List of volume IDs to attach to the virtual machine.

### Optional

- `protected` (Boolean) Whether the volume attachments are protected from detachment.

### Read-Only

- `id` (String) The unique identifier for the volume attachment resource. Format: `vm-{vm_id}-volumes`
- `volume_attachments` (List of Object) List of volume attachment details returned by the API. (see [below for nested schema](#nestedatt--volume_attachments))

<a id="nestedatt--volume_attachments"></a>
### Nested Schema for `volume_attachments`

Read-Only:

- `id` (Number) The volume attachment ID.
- `volume_id` (Number) The volume ID.
- `instance_id` (Number) The instance (VM) ID.
- `device` (String) The device path where the volume is attached.
- `status` (String) The status of the volume attachment.
- `protected` (Boolean) Whether the volume attachment is protected.
- `created_at` (String) The creation timestamp.

## Import

Volume attachments can be imported using the VM ID or the full resource ID:

```shell
# Import using VM ID
terraform import hyperstack_core_volume_attachment.example 12345

# Import using full resource ID
terraform import hyperstack_core_volume_attachment.example vm-12345-volumes
```

## Lifecycle and Timing

### Attachment Process
- The provider calls the attach API and waits approximately **5 seconds** for the attachment to complete.
- Volumes should be in an `available` state before attachment.
- Once attached, volumes will show a `status` of `attached` or `in-use`.

### Detachment Process
- During destroy or replacement, the provider calls the detach API.
- The provider then waits approximately **100 seconds** to ensure volumes are fully detached.
- This wait time prevents "volume is still attached" errors when Terraform attempts to delete the volumes.
- Detached volumes return to `available` state but are **not deleted**.

### Resource Behavior

- **`vm_id` changes**: Forces replacement (detach → re-attach on new VM)
- **`volume_ids` changes**: Forces replacement (detach all → attach new set)
- **`protected` changes**: Can be updated in-place (when implemented)
- **Destroy operation**: Detaches volumes but does NOT delete them

## Notes

- **Volume lifecycle**: When this resource is destroyed, volumes are detached but remain in your environment. Delete the `hyperstack_core_volume` resources separately if you want to remove the volumes.
- **Attachment order**: Volumes are attached in the order specified in the `volume_ids` list, but the actual device paths (e.g., `/dev/vdb`, `/dev/vdc`) are assigned by the hypervisor.
- **Environment matching**: Always create volumes in the same environment as the VM to ensure proper connectivity.
- **Volume state**: Volumes must be in `available` state before they can be attached. Newly created volumes typically reach this state within a few seconds.
- **Multiple attachments**: You can create multiple `hyperstack_core_volume_attachment` resources for the same VM to organize volume management (e.g., separate data and backup volumes).
